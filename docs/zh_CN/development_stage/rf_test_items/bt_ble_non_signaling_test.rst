{IDF_TARGET_BT_BLE_OPTION: default="低功耗蓝牙", esp32="蓝牙及低功耗蓝牙"}

{IDF_TARGET_BT_BLE_OPTION}非信令测试
==============================================

:link_to_translation:`en:[English]`

{IDF_TARGET_BT_BLE_OPTION}非信令测试控制设备发射特定信号，无需建立实际连接，用于评估其发射功率、频谱特性和误码率等关键性能指标，确保设备的无线通信质量。

.. include:: rf_non_signalling_test_setup.inc

开始测试
----------------

.. _ble-non-signalling-test:

.. only:: esp32

    蓝牙/低功耗蓝牙发射性能测试
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    - **Test Mode**：

      * BT TX：用于蓝牙发射性能测试；
      * BLE TX：用于低功耗蓝牙发射性能测试。

    - **Power Level**：设置蓝牙功率等级，支持 0~7 档测试
    - **Channel**: 设置蓝牙测试信道
    - **Hoppe**：使能跳频功能，默认关闭
    - **Ulap**：设置蓝牙地址，使用默认值，仅蓝牙支持
    - **Itaddr**：设置逻辑传输地址，使用默认值，仅蓝牙支持
    - **Syncw**：设置包文件的身份识别码，默认选择 syncw=0x71764129
    - **Payload length**：设置 payload 长度，默认为 250
    - **Data Rate**：设置发包速率和编码序列，支持 BT 1M、2M、3M 和 BLE 1M 四种速率，支持 1010、11110000、prbs9 三种编码序列

    点击 ``start`` 后在 log 窗口中显示蓝牙发射参数说明，参考如下：

    ::

        fcc_bt_tx:txpwr=6,hoppe=0,chan=0,rate=1,DH_type=1,data_type=1

    表明蓝牙发包正常，此时可使用综测仪检测发射性能。

    .. figure:: ../../../_static/rf_test_tool/esp32_bt_tx_on.png
        :align: center
        :scale: 80%

        蓝牙发射性能

    .. figure:: ../../../_static/rf_test_tool/esp32_ble_tx_on.png
        :align: center
        :scale: 80%

        低功耗蓝牙发射性能

    蓝牙接收性能测试
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    - **Test Mode**：设置为 BT RX 用于蓝牙接收性能测试
    - **Channel**：设置蓝牙测试信道
    - **Ulap**：设置蓝牙地址，使用默认值，仅蓝牙支持
    - **Itaddr**：设置逻辑传输地址，使用默认值，仅蓝牙支持
    - **Data Rate**：设置收包速率，支持 BT 1M、2M、3M，默认 prbs9 编码序列

    点击 ``start`` 后使用仪器在测试信道发包，完成后点击 ``stop``，在 log 窗口中显示收包信息如下：

    ::

        3e8 3e8 0 0 0 0 0 0 w 0 0 0 0 0 0 0 0 p 4176 45cf ddfd b 7ca240 0

    其中：

    - 第 1 个参数 Res[0]（16 进制）表示本次测试收到的总包数。本次测试中，总包数为 3e8。
    - 第 2 个参数 Res[1]（16 进制）表示本次测试收到的对应速率包的数量。本次测试中，对应速率包的数量为 3e8。
    - 倒数第 2 个参数 Res[22]（16 进制）表示本次测试收到的对应速率的总码数。本次测试中，对应速率的总码数为 7ca240。
    - 最后 1 个参数 Res[23]（16 进制）表示本次测试总共收到的误码个数。本次测试中，误码个数为 0。

    根据上述参数，可以计算：

    - 误码率 BT_BER = Res[23]/Res[22]
    - BT_RSSI = (-Res[18]]-Res[20])/Res[0]

    .. figure:: ../../../_static/rf_test_tool/esp32_bt_rx_on.png
        :align: center
        :scale: 80%

        蓝牙接收性能测试

    低功耗蓝牙接收性能测试
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    - **Test Mode**：选择 BLE RX 用于低功耗蓝牙接收性能测试
    - **Channel**：设置低功耗蓝牙测试信道
    - **Syncw**：设置包文件的身份识别码，默认选择 syncw=0x71764129
    - **Data Rate**：设置收包速率，默认为 BLE 1M 速率，prbs9 编码序列

    点击 ``start`` 后使用仪器在测试信道发包，完成后点击 ``stop``，在 log 窗口中显示收包信息如下：

    ::

        3e8 3e8 0 0 0 0 0 0 0 0 w 0 0 0 0 0 0 0 0 p 5b83 58cf 6acb

    其中：

    - 第 1 个参数 Res[0]（16 进制）表示本次测试收到的总包数。本次测试中，总包数为 3e8。
    - 第 2 个参数 Res[1]（16 进制）表示本次测试在对应速率下收到的包的数量。本次测试中，对应速率包的数量为 3e8。
    - 倒数第 3 个参数 Res[20]（16 进制）表示本次测试所有包的带内功率。本次测试中，所有包的带内功率为 5b83。
    - 最后 1 个参数 Res[22]（16 进制）表示本次测试所有包的增益。本次测试中，所有包的增益为 6acb。

    根据上述参数，可以计算：

    - 丢包率 BLE_PER = [1-(Res[1]/Sent_Packet_Numbers)]*100%<=30.8%
    - BLE_RSSI = (-Res[20]-Res[22])/Res[0]

    .. figure:: ../../../_static/rf_test_tool/esp32_ble_rx_on.png
        :align: center
        :scale: 80%

        低功耗蓝牙接收性能测试

.. only:: not esp32

    低功耗蓝牙发射性能测试
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    - **Test Mode**：

      * BLE50 TX：用于发射性能测试；
      * BLE50 TX continue：高发包占空比，用于认证测试。

    - **Power Level**：设置低功耗蓝牙发射功率等级，支持 0~15 档测试
    - **Channel**：设置低功耗蓝牙测试信道
    - **Hoppe**：使能跳频功能，默认关闭
    - **Ulap**：设置蓝牙地址，默认不使能
    - **Itaddr**：设置逻辑传输地址，默认不使能
    - **Syncw**：设置包文件的身份识别码，默认选择 syncw=0x71764129
    - **Payload length**：设置 payload 长度，默认使用 250
    - **Data Rate**：设置发包速率和编码序列，支持 BLE 1M、2M、125K、500K 四种速率，支持 1010、11110000、prbs9 三种编码序列

    点击 ``start`` 后在 log 窗口中显示低功耗蓝牙发射参数说明，参考如下：

    ::

        fcc_le_tx_syncw:txpwr=15,chan=0,len=250,data_type=0,syncw=0x71764129,rate=0,tx_num=0,contin_en=0,delay=0,hopp_en=0

    表明低功耗蓝牙发包正常，此时可使用综测仪检测发射性能。

    .. figure:: ../../../_static/rf_test_tool/esp32c6_ble_tx_on.png
        :align: center
        :scale: 80%

        低功耗蓝牙发射性能测试

    低功耗蓝牙接收性能测试
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    {IDF_TARGET_TWELFTH_PARA:default="收到正确包", esp32c3="收到正确包", esp32s3="收到正确包"}

    {IDF_TARGET_RSSI:default="Res[11]/(Res[1])", esp32c3="Res[11]/(Res[1])", esp32s3="Res[11]/(Res[1])"}

    - **Test Mode**：选择 BLE50 RX 用于低功耗蓝牙接收性能测试。
    - **Channle**：设置低功耗蓝牙测试信道。
    - **Syncw**：设置包文件的身份识别码，默认选择 syncw=0x71764129。
    - **Data Rate**：设置收包速率，默认为 prbs9 编码序列。

    点击 ``start`` 后使用仪器在测试信道发包，完成后点击 ``stop``，在 log 窗口中显示收包信息如下：

    ::

        3e8 3e8 0 0 0 0 0 0 0 0 p -53276 -24131 0 29422

    其中：

    - 第 1 个参数 Res[0]（16 进制）表示本次测试收到的总包数。本次测试中，总包数为 3e8。
    - 第 2 个参数 Res[1]（16 进制）表示本次测试在对应速率下收到的包的数量。本次测试中，对应速率包的数量为 3e8。
    - 第 12 个参数 Res[11]（10 进制）表示本次测试{IDF_TARGET_TWELFTH_PARA}的 RSSI。本次测试中，RSSI 为 -53276。

    根据上述参数，可以计算：

    - 丢包率 PER = [1-(Res[1]/Sent_Packet_Numbers)]*100%<=30.8%
    - 每个包的 RSSI = {IDF_TARGET_RSSI}


      .. figure:: ../../../_static/rf_test_tool/esp32c6_ble_rx_on.png
          :align: center
          :scale: 80%

          低功耗蓝牙接收性能测试

附录
----------------

本附录为射频调试或测试所需参考的对照表。


.. only:: esp32

  下表主要用于说明 {IDF_TARGET_NAME} 的{IDF_TARGET_BT_BLE_OPTION}的功率等级及对应的目标功率，用于射频调试或测试对照。

  .. list-table:: {IDF_TARGET_NAME} 蓝牙/低功耗蓝牙发射功率等级
    :widths: 40 60

    * - 功率等级
      - ESP32 蓝牙/低功耗蓝牙发射功率 (dBm)
    * - 0
      - -12
    * - 1
      - -9
    * - 2
      - -6
    * - 3
      - -3
    * - 4
      - 0
    * - 5
      - 3
    * - 6
      - 6
    * - 7
      - 9


.. only:: esp32c6

    低功耗蓝牙发射功率等级
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    下表主要用于说明 {IDF_TARGET_NAME} 的{IDF_TARGET_BT_BLE_OPTION}的功率等级及对应的目标功率，用于射频调试或测试对照。

    .. list-table:: {IDF_TARGET_NAME} 低功耗蓝牙发射功率等级
        :widths: 40 60

        * - 功率等级
          - 低功耗蓝牙发射功率 (dBm)
        * - 0
          - -15
        * - 1
          - -15
        * - 2
          - -15
        * - 3
          - -15
        * - 4
          - -12
        * - 5
          - -9
        * - 6
          - -6
        * - 7
          - -3
        * - 8
          - 0
        * - 9
          - 3
        * - 10
          - 6
        * - 11
          - 9
        * - 12
          - 12
        * - 13
          - 15
        * - 14
          - 18
        * - 15
          - 20

    低功耗蓝牙 5.0 PHY 信道与索引
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    对于低功耗蓝牙，EspRFTestTool 工具包使用信道索引 (channel index) 来识别信道。

    .. list-table::  {IDF_TARGET_NAME} 低功耗蓝牙 5.0 PHY 信道与索引
        :widths: 50 60 50

        * - PHY 信道
          - 射频中心频率（MHz）
          - 信道索引
        * - 0
          - 2402
          - 37
        * - 1
          - 2404
          - 0
        * - 2
          - 2406
          - 1
        * - ...
          - ...
          - ...
        * - 11
          - 2424
          - 10
        * - 12
          - 2426
          - 38
        * - 13
          - 2428
          - 11
        * - 14
          - 2430
          - 12
        * - ...
          - ...
          - ...
        * - 38
          - 2478
          - 36
        * - 39
          - 2480
          - 39


.. only:: not esp32 and not esp32c6

    低功耗蓝牙发射功率等级
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    下表主要用于说明 {IDF_TARGET_NAME} 的{IDF_TARGET_BT_BLE_OPTION}的功率等级及对应的目标功率，用于射频调试或测试对照。

    .. list-table:: {IDF_TARGET_NAME} 低功耗蓝牙发射功率等级
        :widths: 40 60

        * - 功率等级
          - 低功耗蓝牙发射功率 (dBm)
        * - 0
          - -24
        * - 1
          - -21
        * - 2
          - -18
        * - 3
          - -15
        * - 4
          - -12
        * - 5
          - -9
        * - 6
          - -6
        * - 7
          - -3
        * - 8
          - 0
        * - 9
          - 3
        * - 10
          - 6
        * - 11
          - 9
        * - 12
          - 12
        * - 13
          - 15
        * - 14
          - 18
        * - 15
          - 20

    低功耗蓝牙 5.0 PHY 信道与索引
    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^

    对于低功耗蓝牙，EspRFTestTool 工具包使用信道索引 (channel index) 来识别信道。

    .. list-table::  {IDF_TARGET_NAME} 低功耗蓝牙 5.0 PHY 信道与索引
        :widths: 50 60 50

        * - PHY 信道
          - 射频中心频率（MHz）
          - 信道索引
        * - 0
          - 2402
          - 37
        * - 1
          - 2404
          - 0
        * - 2
          - 2406
          - 1
        * - ...
          - ...
          - ...
        * - 11
          - 2424
          - 10
        * - 12
          - 2426
          - 38
        * - 13
          - 2428
          - 11
        * - 14
          - 2430
          - 12
        * - ...
          - ...
          - ...
        * - 38
          - 2478
          - 36
        * - 39
          - 2480
          - 39
