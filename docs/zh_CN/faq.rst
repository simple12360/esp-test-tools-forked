常见问题
=================

:link_to_translation:`en:[English]`

COM 相关错误
----------------------

打开工具后，在 COM 下拉菜单中找不到对应串口？
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

首先查看设备管理器，确认串口已经安装成功。若没有成功，检查驱动是否有问题。

“连接串口失败”，如下图所示：
""""""""""""""""""""""""""""""""""""""""""""""""

.. figure:: ../_static/flash_download_tool/serial_port_connection_failure.jpg
    :align: center
    :scale: 90%

    串口连接失败

- 确认选择的 COM 口是否为需要下载的 COM 口
- 检查串口是否被其他线程占用。

同步相关错误
-----------------------

工具一直停留在下图界面，该怎么解决？
""""""""""""""""""""""""""""""""""""""""""""""""""""

.. figure:: ../_static/flash_download_tool/download_panel.jpg
    :align: center
    :scale: 90%

工具停留在同步过程中可能有以下几种原因。

- 硬件原因：设备没有处于下载模式
- 软件原因：待下载的设备选择错误

eFuse 相关错误
-----------------------

点击 START 后出现下图问题，是什么原因？
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

.. figure:: ../_static/flash_download_tool/efuse_error.jpg
    :align: center
    :scale: 90%

若下载命令行框中出现 ``ESP8266 Chip efuse check error esp_check_mac_and_efuse``，代表设备的 eFuse 出现错误，可能有以下原因：

- 设备的 eFuse 没有问题，待下载设备选择有误。此时，请重新选择待下载设备。
- 设备的 eFuse 确有错误。此时，请联系乐鑫获取 esptool.exe 以及操作指令，并将 eFuse 读出后交由乐鑫进行调试。

下载相关错误
----------------------

下载过程出现错误，什么原因？
""""""""""""""""""""""""""""""""""""""""""""

出现下载问题，请首先确认：

- 设备的 TX/RX 没有与其他软件复用
- 设备实际的 flash 不小于固件的大小
- 若出现 MD5 校验错误，请首先擦除整片 flash，然后尝试再次下载

运行相关错误
-----------------------

固件下载完成后，重新上电 crash。
""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""""

请首先确认烧录的固件本身没有问题，而后确认以下方面：
- 待下载设备的选择是否正确
- Flash 启动模式的配置是否正确
- Flash 下载模式的选择是否正确




如何将认证测试的功率参数更新到应用固件？
----------------------------------------------------------------------

  请参考 ESP32-Series_PowerLimitTool 使用说明。

定频测试辐射二次、三次、四次谐波超标。
----------------------------------------------------------------------

  - 对于基于 ESP 芯片的设计，则排查 RF layout，匹配和 PA 供电部分，通过调整 RF 匹配，PA 电源线滤波网络来抑制谐波。
  - 对于基于 ESP 模组的产品，则模组下面放置底板，底板通常是产品的 PCB 板。
  - 在定频测试工具的 attenuation 里输入数值来降低功率。

PSD 和功率超标。
---------------------------

  - 确认 RF 匹配是否调试正确。
  - 在定频测试工具的 attenuation 里输入数值来降低功率。

自适应测试不过。
------------------------------------

  - 确认测试方法是否正确，按照前面第三章 Adaptivity 进行设置，此时频谱仪应看到正常的流量。
  - 重复测试，排查实验室环境稳定性。

1 GHz 以下辐射杂散超标。
------------------------------------------

  - 排查外设通信，UART、SPI、IIC 等。
  - 排查串口板和 UART 线，USB 线。

蓝牙 Blocking 测试 UART1 log 异常。
-----------------------------------------------------------

  - 检查硬件连接是否异常。
  - 交换 UART1 的 TX 和 RX。





串口问题
--------------

1. **打开工具后，在 “Com Port” 下拉菜单中找不到对应串口？**

   - 首先查看设备管理器，确认串口已经安装成功。若没有成功，检查驱动是否有问题。

2. **串口无法打开？**

   - 检查是否被 “EspRFTestTool” 占用，请先将 “DownloadTool” 界面关闭，回到 “EspRFTestTool” 界面关闭串口后再次尝试。也可能是被其他线程占用。

下载问题
--------------

1. **设备不能进入下载模式？**

   - 参考 2.1 章节检查硬件连接是否正确。若待下载设备为整机，需确保 TXD/RXD 未被产品上的其他主机占用。

2. **界面显示已经下载成功，还是无法正常测试。**

   - 请检查“Chip Type”与待下载设备的芯片是否一致。另外，ESP8266 和 ESP8285 的射频测试固件有两个，一个是 26 M 晶振对应的固件，另一个是 40 M 晶振对应的固件，下载时请注意区分。





1. **如何将认证测试的功率参数更新到应用固件？**

   请参考 ESP32-Series_PowerLimitTool 使用说明。

2. **定频测试辐射二次、三次、四次谐波超标。**

   - 对于基于 ESP 芯片的设计，则排查 RF layout，匹配和 PA 供电部分，通过调整 RF 匹配，PA 电源线滤波网络来抑制谐波。
   - 对于基于 ESP 模组的产品，则模组下面放置底板，底板通常是产品的 PCB 板。
   - 在定频测试工具的 attenuation 里输入数值来降低功率。

3. **Band Edge 和 RE in Restricted Band 超标。**

   - 确认 RF 匹配是否调试正确
   - 在定频测试工具的 attenuation 里输入数值来降低功率。






1. **如何将认证测试的功率参数更新到应用固件？**

   请参考 ESP32-Series_PowerLimitTool 使用说明。

2. **功率和 PSD 超标**

   - 确认 RF 匹配是否调试正确
   - 在定频测试工具的 attenuation 里输入数值来降低功率。




如何确定 USB 端口号
-------------------------------------

  可以使用命令 ``ls /dev/ttyUSB*`` 查看

如何获取 DUT MAC 地址
------------------------------------

  - 进入 minicom: ``minicom -D /dev/ttyUSB*``
  - 输入命令 ``query``，打印出的 ``dut_mac`` 即为 ``DUT MAC``

如何烧录企业级证书
----------------------------------

  目前证书包含在固件中，无需烧入

工具无法启动
------------------------

  请检查 python 版本，以及工具是否完整

工具脚本启动后无法监听 UCC 命令
----------------------------------------------------

  检查是否在 PC 上正确配置 IP 地址

dut 出现乱码，无法正确读写
---------------------------------------------

  请检查 dut 是否正确烧录了 bin 文件，以及供电是否正常

测试数据保存
------------------------

完成测试后，测试数据将由实验室人员保存并提交给 Wi-Fi 联盟，待数据审查完毕后可获取 WFA 证书。

如遇到测试失败，需要 debug，请提供测试 log，log 应包括 (UCC/dut/sniffer)，其中 dut_log 路径为 ``espesigma_qt/espsigma/esp_sigma_ca/logs``。